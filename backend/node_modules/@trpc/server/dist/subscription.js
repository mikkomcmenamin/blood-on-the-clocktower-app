'use strict';

Object.defineProperty(exports, '__esModule', { value: true });

var TRPCError = require('./TRPCError-bd37df84.js');
var observable = require('./observable-464116ac.js');

function subscriptionPullFactory(opts) {
    // eslint-disable-next-line @typescript-eslint/no-explicit-any
    let timer;
    let stopped = false;
    async function _pull(emit) {
        /* istanbul ignore next */ if (stopped) {
            return;
        }
        try {
            await opts.pull(emit);
        } catch (err /* istanbul ignore next */ ) {
            emit.error(TRPCError.getTRPCErrorFromUnknown(err));
        }
        /* istanbul ignore else */ if (!stopped) {
            timer = setTimeout(()=>_pull(emit), opts.intervalMs);
        }
    }
    return observable.observable((emit)=>{
        _pull(emit).catch((err)=>emit.error(TRPCError.getTRPCErrorFromUnknown(err)));
        return ()=>{
            clearTimeout(timer);
            stopped = true;
        };
    });
}

exports.subscriptionPullFactory = subscriptionPullFactory;
