import { a as getTRPCErrorFromUnknown } from './TRPCError-7de0a793.mjs';
import { o as observable } from './observable-ade1bad8.mjs';

function subscriptionPullFactory(opts) {
    // eslint-disable-next-line @typescript-eslint/no-explicit-any
    let timer;
    let stopped = false;
    async function _pull(emit) {
        /* istanbul ignore next */ if (stopped) {
            return;
        }
        try {
            await opts.pull(emit);
        } catch (err /* istanbul ignore next */ ) {
            emit.error(getTRPCErrorFromUnknown(err));
        }
        /* istanbul ignore else */ if (!stopped) {
            timer = setTimeout(()=>_pull(emit), opts.intervalMs);
        }
    }
    return observable((emit)=>{
        _pull(emit).catch((err)=>emit.error(getTRPCErrorFromUnknown(err)));
        return ()=>{
            clearTimeout(timer);
            stopped = true;
        };
    });
}

export { subscriptionPullFactory };
